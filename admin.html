{% extends "base.html" %}
{% block content %}

<div class="dashboard-container">
    <h2>Pengelolaan Pendaftaran</h2>

    <!-- Statistik -->
    <div class="stats">
        <div class="card">
            <p>Total Pendaftar :</p>
            <h3>{{ total_pendaftar }}</h3>
        </div>
        <div class="card">
            <p>Didisposisi :</p>
            <h3>{{ disposisi }}</h3>
        </div>
        <div class="card">
            <p>Diterima :</p>
            <h3>{{ diterima }}</h3>
        </div>
        
    </div>

    <!-- Tabel Pendaftar -->
    <div class="table-container">
        <div class="table-header">
            <h3>Daftar Pendaftar :</h3>
            <form method="GET" action="{{ url_for('admin') }}">
                <input type="text" name="search" placeholder="Search . . ." value="{{ search or '' }}">
                <button type="submit">üîç</button>
            </form>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Nama</th>
                    <th>Email</th>
                    <th>No. Telp</th>
                    <th>Universitas</th>
                    <th>Tgl Mulai</th>
                    <th>Tgl Selesai</th>
                    <th>Proposal</th>
                    <th>Surat Izin Magang</th>
                    <th>Surat Balasan</th>
                    <th>Status</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                <tr>
                    <td>{{ row.nama }}</td>
                    <td>{{ row.email }}</td>
                    <td>{{ row.no_telp }}</td>
                    <td>{{ row.universitas }}</td>
                    <td>{{ row.tgl_mulai }}</td>
                    <td>{{ row.tgl_selesai }}</td>

                    <!-- link proposal -->
                    <td>
                        {% if row.proposal %}
                            <a href="{{ url_for('uploaded_file', filename=row.proposal) }}" target="_blank">üìÑ Lihat Proposal</a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    
                    <!-- link surat izin -->
                    <td>
                        {% if row.surat_izin %}
                            <a href="{{ url_for('uploaded_file', filename=row.surat_izin) }}" target="_blank">üìë Lihat Surat</a>
                        {% else %}
                            -
                        {% endif %}
                    </td>

                    
                    <!-- upload & lihat surat balasan -->
                    <td>
                        {% if row.surat_balasan %}
                            <a href="{{ url_for('uploaded_file', filename=row.surat_balasan) }}" target="_blank">üì• Lihat Balasan</a>
                        {% else %}
                            <form action="{{ url_for('upload_balasan', id=row.id) }}" method="POST" enctype="multipart/form-data">
                                <input type="file" name="surat_balasan" required>
                                <button type="submit" class="btn-upload">‚¨Ü Upload</button>
                            </form>
                        {% endif %}
                    </td>

                    <td>{{ row.status or '-' }}</td>
                    <td class="actions">
                        <a href="{{ url_for('update_status', id=row.id, status='sedang didisposisi') }}" class="btn-action blue" title="Disposisi">üìÇ</a>
                        <a href="{{ url_for('accept_pendaftaran', id=row.id) }}" class="btn-action green" title="Terima">‚úî</a>
                        <a href="{{ url_for('reject_pendaftaran', id=row.id) }}" class="btn-action red" title="Tolak">‚ùå</a>
                    </td>
                </tr>
                {% else %}
                <tr><td colspan="6">Belum ada data pendaftar</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pagination -->
        <div class="pagination">
            {% if page > 1 %}
                <a href="{{ url_for('admin_dashboard', page=page-1, search=search) }}">‚èÆ Prev</a>
            {% endif %}

            {% for p in range(1, total_pages + 1) %}
                {% if p == page %}
                    <span class="active">{{ p }}</span>
                {% else %}
                    <a href="{{ url_for('admin_dashboard', page=p, search=search) }}">{{ p }}</a>
                {% endif %}
            {% endfor %}

            {% if page < total_pages %}
                <a href="{{ url_for('admin_dashboard', page=page+1, search=search) }}">Next ‚è≠</a>
            {% endif %}
        </div>
    </div>
</div>

<!-- CSS -->
<style>
.dashboard-container { font-family: Arial, sans-serif; padding: 20px; }
.stats { display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap; }
.card {
    background: #224B84; color: white; padding: 20px;
    border-radius: 15px; flex: 1; text-align: center;
    min-width: 180px;
}
.table-container {
    background: #224B84; padding: 15px; border-radius: 15px; color: white;
}
.table-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
.table-header input { border-radius: 20px; padding: 5px 10px; border: none; }
.table-header button { background: white; border: none; border-radius: 50%; cursor: pointer; padding: 5px 10px; }
table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; color: black; }
th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
.actions { display: flex; justify-content: center; gap: 6px; }
.btn-action {
    padding: 4px 8px;
    border-radius: 6px;
    text-decoration: none;
    font-size: 14px;
    font-weight: bold;
}
.btn-action.blue { background: #3B82F6; color: white; }
.btn-action.green { background: #22C55E; color: white; }
.btn-action.red { background: #EF4444; color: white; }
.btn-action:hover { opacity: 0.85; }

.btn-upload {
    background: #FFD700;
    color: black;
    border: none;
    border-radius: 6px;
    padding: 4px 8px;
    cursor: pointer;
    margin-top: 5px;
}
.btn-upload:hover {
    background: #E6C200;
}

.pagination {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    gap: 5px;
    align-items: center;
    flex-wrap: wrap;
}
.pagination a, .pagination span {
    background: #224B84;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    text-decoration: none;
}
.pagination .active {
    background: #1a3865;
    font-weight: bold;
}
.pagination a:hover {
    background: #1a3865;
}
</style>

{% endblock %}
